<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dark Star Proxy Browser</title>
  <style>
    body {
      margin:0; padding:0;
      font-family:Arial,sans-serif;
      background:#0d0d0d; color:#eee;
      display:flex; flex-direction:column;
      height:100vh;
    }
    #tabBar {
      display:flex; background:#111; padding:6px; overflow-x:auto;
    }
    .tabButton {
      padding:6px 12px; margin-right:4px;
      background:#222; border:none;
      border-radius:5px; color:#eee;
      cursor:pointer;
    }
    .tabButton.active { background:#6a5acd; }
    .tabButton .closeBtn {
      margin-left:8px; color:#f55;
      cursor:pointer; font-weight:bold;
    }
    #controls {
      display:flex; justify-content:center;
      align-items:center; margin:10px 0;
      gap:6px; flex-wrap:wrap;
    }
    #urlInput, #searchInput {
      padding:10px 20px; border-radius:30px;
      border:none; background:#222; color:#eee;
      font-size:16px;
      box-shadow: inset 0 0 8px #444;
      outline:none;
    }
    #urlInput { flex:1; min-width:300px; }
    #urlInput:focus, #searchInput:focus {
      box-shadow: inset 0 0 12px #6a5acd;
      background:#111;
    }
    button {
      padding:8px 16px;
      border-radius:30px;
      border:none;
      background:#6a5acd;
      color:white;
      font-weight:bold;
      cursor:pointer;
      margin:4px;
    }
    button:hover { background:#5848c2; }
    iframe {
      flex:1; width:100%; border:none;
      display:none;
    }
    #main {
      flex:1; display:flex; flex-direction:column;
    }
  </style>
</head>
<body>

<div id="tabBar"></div>

<!-- Controls -->
<div id="controls">
  <button onclick="goBack()">&#8592;</button>
  <button onclick="goForward()">&#8594;</button>
  <button onclick="reloadTab()">&#10227;</button>
  <input type="text" id="urlInput" placeholder="Enter search or web address" />
  <button onclick="openTab()">Go</button>
  <input type="text" id="searchInput" placeholder="Search DuckDuckGo" />
  <button onclick="searchDuckDuckGo()">Search</button>
  <button id="openBlankBtn" onclick="openInBlank()">Open in About:Blank</button>
</div>

<div id="main"></div>

<script>
// âœ¨ Your deployed Node proxy base URL here! 
const proxyBase = 'https://proxy-6zpzod01p-slimmervessels-projects.vercel.app/proxy?url=';

let tabs = [];
let activeTab = null;

function createTab(title, url) {
  const tabBar = document.getElementById('tabBar');
  const main = document.getElementById('main');
  const tabId = 'tab-' + tabs.length;

  const btn = document.createElement('button');
  btn.className = 'tabButton';
  btn.innerHTML = title + ' <span class="closeBtn" onclick="closeTab(event,\'' + tabId + '\')">&times;</span>';
  btn.onclick = () => switchTab(tabId);
  tabBar.appendChild(btn);

  const iframe = document.createElement('iframe');
  iframe.id = tabId;
  main.appendChild(iframe);

  // Load via proxy URL (iframe src set to proxied URL)
  const proxiedUrl = proxyBase + encodeURIComponent(url);
  iframe.src = proxiedUrl;
  iframe.onload = () => iframe.style.display = 'block';
  iframe.onerror = () => {
    iframe.style.display = 'none';
    alert('Failed to load ' + url + ' via proxy.');
  };

  tabs.push({ id: tabId, button: btn, iframe: iframe, url: url });
  switchTab(tabId);
}

function switchTab(id) {
  tabs.forEach(tab => {
    tab.iframe.style.display = 'none';
    tab.button.classList.remove('active');
    if (tab.id === id) {
      tab.iframe.style.display = 'block';
      tab.button.classList.add('active');
      activeTab = tab;
    }
  });
}

function closeTab(e, id) {
  e.stopPropagation();
  const tab = tabs.find(t => t.id === id);
  if (!tab) return;
  tab.iframe.remove();
  tab.button.remove();
  tabs = tabs.filter(t => t.id !== id);
  if (activeTab && activeTab.id === id) {
    if (tabs.length) switchTab(tabs[tabs.length - 1].id);
    else activeTab = null;
  }
}

function openTab() {
  let url = document.getElementById('urlInput').value.trim();
  if (!url) return;
  if (!/^https?:\/\//i.test(url)) url = 'https://' + url;
  createTab(url, url);
}

function searchDuckDuckGo() {
  let query = document.getElementById('searchInput').value.trim();
  if (!query) return;
  let url = 'https://duckduckgo.com/?q=' + encodeURIComponent(query);
  createTab('DuckDuckGo: ' + query, url);
}

function openInBlank() {
  if (!activeTab) return alert('No active tab!');

  // Fetch the proxied URL content and open in new window
  fetch(proxyBase + encodeURIComponent(activeTab.url))
    .then(res => res.text())
    .then(html => {
      const newWindow = window.open();
      newWindow.document.write(html);
      newWindow.document.close();
    })
    .catch(() => {
      alert('Failed to load content in about:blank');
    });
}

// Navigation buttons
function goBack() {
  if (activeTab && activeTab.iframe.contentWindow) activeTab.iframe.contentWindow.history.back();
}
function goForward() {
  if (activeTab && activeTab.iframe.contentWindow) activeTab.iframe.contentWindow.history.forward();
}
function reloadTab() {
  if (activeTab) {
    // Reload via proxy URL
    const proxiedUrl = proxyBase + encodeURIComponent(activeTab.url);
    activeTab.iframe.src = proxiedUrl;
  }
}

// Enter key support
document.getElementById('urlInput').addEventListener('keypress', e => {
  if (e.key === 'Enter') openTab();
});
document.getElementById('searchInput').addEventListener('keypress', e => {
  if (e.key === 'Enter') searchDuckDuckGo();
});
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dark Star Proxy Browser</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; }
  header { background:#111; color:#fff; padding:20px; text-align:center; }
  main { margin:20px auto; max-width:1200px; }
  input[type="text"] { width:50%; padding:8px; border-radius:6px; border:1px solid #ccc; font-size:16px; }
  button { padding:8px 14px; margin-left:5px; border-radius:6px; border:none; background:#4285F4; color:white; cursor:pointer; }
  button:hover { background:#3367D6; }
  #tabs { display:flex; margin-top:20px; border-bottom:2px solid #ccc; flex-wrap: wrap; }
  .tab { padding:8px 12px; cursor:pointer; margin-right:4px; background:#eee; border-radius:6px 6px 0 0; display:flex; align-items:center; font-weight:bold; }
  .tab.active { background:#fff; border-bottom:2px solid #4285F4; }
  .tab-close { margin-left:6px; color:red; font-weight:bold; cursor:pointer; }
  #browserContainer { border:2px solid #ccc; height:700px; margin-top:0; border-radius:0 6px 6px 6px; }
</style>
</head>
<body>

<header>
  <h1>DARK STAR PROXY BROWSER</h1>
</header>

<main>
  <input type="text" id="urlInput" placeholder="Enter website URL">
  <button onclick="openInNewTab()">Open in New Tab</button>
  <button onclick="openInTab()">Open in Page</button>

  <div id="tabs"></div>
  <div id="browserContainer">Your site will appear here.</div>
</main>

<footer>
  <p>Thomas Ash</p>
</footer>

<script>
const tabs = [];
let activeTabIndex = -1;

// Create iframe using AllOrigins proxy
function createIframe(url) {
  const iframe = document.createElement('iframe');
  iframe.src = 'https://allorigins.win/raw?url=' + encodeURIComponent(url);
  iframe.style.width = '100%';
  iframe.style.height = '100%';
  iframe.style.border = '0';
  return iframe;
}

// Render tabs bar
function renderTabs() {
  const tabsDiv = document.getElementById('tabs');
  tabsDiv.innerHTML='';
  tabs.forEach((tab,index)=>{
    const tabEl = document.createElement('div');
    tabEl.className = 'tab' + (index===activeTabIndex?' active':'');
    tabEl.textContent = tab.url;

    tabEl.onclick = ()=> { activeTabIndex=index; renderTabs(); renderActiveTab(); };

    const closeBtn = document.createElement('span');
    closeBtn.className='tab-close';
    closeBtn.textContent='Ã—';
    closeBtn.onclick = (e)=>{
      e.stopPropagation();
      tabs.splice(index,1);
      if(activeTabIndex>=tabs.length) activeTabIndex=tabs.length-1;
      renderTabs();
      renderActiveTab();
    };

    tabEl.appendChild(closeBtn);
    tabsDiv.appendChild(tabEl);
  });
}

// Render active tab
function renderActiveTab() {
  const container = document.getElementById('browserContainer');
  container.innerHTML='';
  if(activeTabIndex<0 || activeTabIndex>=tabs.length){
    container.innerHTML='Your site will appear here.';
    return;
  }
  container.appendChild(tabs[activeTabIndex].iframe);
}

// Open in-page tab
function openInTab() {
  let url = document.getElementById('urlInput').value.trim();
  if(!url) return alert('Please enter a URL.');
  if(!/^https?:\/\//i.test(url)) url='https://'+url;

  const iframe=createIframe(url);
  tabs.push({url,iframe});
  activeTabIndex=tabs.length-1;
  renderTabs();
  renderActiveTab();
}

// Open in new about:blank tab
async function openInNewTab() {
  let url = document.getElementById("urlInput").value.trim();
  if (!url) return alert("Please enter a URL.");
  if (!/^https?:\/\//i.test(url)) url = "https://" + url;

  const newWindow = window.open('', '_blank');
  if (!newWindow) return alert("Popup blocked. Please allow popups for this site.");

  const apiUrl = "https://api.allorigins.win/get?url=" + encodeURIComponent(url);

  try {
    const response = await fetch(apiUrl);
    const data = await response.json();

    newWindow.document.open();
    newWindow.document.write(data.contents);
    newWindow.document.close();
  } catch (err) {
    newWindow.close();
    alert("Failed to load site through proxy: " + err);
  }
}

// Enter key triggers in-page tab
document.getElementById('urlInput').addEventListener('keypress',function(e){
  if(e.key==='Enter') openInTab();
});
</script>

</body>
</html>
